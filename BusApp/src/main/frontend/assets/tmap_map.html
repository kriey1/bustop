<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>simpleMap</title>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=2E98KPZpX52m9sP7J4ES574buetOtyM38K"></script>
  <script type="text/javascript">
    var map, markerArr = [];

    function initTmap() {
      map = new Tmapv2.Map("map_div", {
        center: new Tmapv2.LatLng(37.56520450, 126.98702028),
        width: "100%",
        height: "400px",
        zoom: 17
      });
    }

    function searchLocation(searchKeyword) {
      var headers = { appKey: "2E98KPZpX52m9sP7J4ES574buetOtyM38K" };
      
      $.ajax({
        method: "GET",
        headers: headers,
        url: "https://apis.openapi.sk.com/tmap/pois?version=1&format=json",
        data: {
          searchKeyword: searchKeyword,
          resCoordType: "EPSG3857",
          reqCoordType: "WGS84GEO",
          count: 10
        },
        success: function (response) {
          const pois = response.searchPoiInfo.pois.poi;
          
          // 기존 마커 제거
          if (markerArr.length > 0) {
            markerArr.forEach(marker => marker.setMap(null));
            markerArr = [];
          }

          pois.forEach((poi, index) => {
            const lat = Number(poi.frontLat);
            const lon = Number(poi.frontLon);

            const marker = new Tmapv2.Marker({
              position: new Tmapv2.LatLng(lat, lon),
              icon: "/upload/tmap/marker/pin_b_m_" + index + ".png",
              iconSize: new Tmapv2.Size(24, 38),
              map: map
            });
            markerArr.push(marker);
          });

          // React Native로 데이터 전달
          if (window.ReactNativeWebView) {
            window.ReactNativeWebView.postMessage(JSON.stringify({ pois }));
          }
        },
        error: function (request, status, error) {
          console.log("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
        }
      });
    }

    window.onload = initTmap;
  </script>
</head>
<body>
  <div id="map_div" style="width:100%; height:400px;"></div>
</body>
</html>
